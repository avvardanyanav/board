<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Renovation Moodboard (Free)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- React 18 UMD + Babel (for JSX in one file). Safe for small apps like this. -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root {
      --bg: #0b0d10;
      --panel: #12151a;
      --muted: #8b97a8;
      --text: #e9edf2;
      --accent: #69d2ff;
      --accent-2: #c2f970;
      --danger: #ff6b6b;
      --card: #151a21;
      --border: #222832;
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 20% -10%, #17202b 0%, #0b0d10 55%), var(--bg);
      color: var(--text);
      font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    header {
      position: sticky; top: 0; z-index: 10;
      backdrop-filter: saturate(140%) blur(10px);
      background: color-mix(in srgb, var(--panel) 86%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
    h1 {
      margin: 0 0 6px; font-size: 18px; letter-spacing: .3px;
      display: flex; align-items: center; gap: 10px;
    }
    .badge { padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); font-size: 12px; }

    .controls {
      display: grid; gap: 10px; grid-template-columns: 1fr minmax(160px, 220px) minmax(160px, 220px) auto auto;
      align-items: center;
    }
    .controls input[type="url"],
    .controls input[type="text"],
    .controls select,
    .controls textarea {
      width: 100%;
      background: var(--card); color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px; padding: 10px 12px;
      outline: none;
    }
    .controls textarea { resize: vertical; min-height: 40px; grid-column: 1 / -1; }
    .controls .row { display: contents; }
    button {
      background: linear-gradient(180deg, color-mix(in srgb, var(--accent) 85%, #fff 0%) 0%, var(--accent) 100%);
      color: #00121a; border: 0; border-radius: 10px; font-weight: 600; padding: 10px 14px; cursor: pointer;
    }
    button.secondary { background: #1b232e; color: var(--text); border: 1px solid var(--border); }
    button.ghost { background: transparent; border: 1px solid var(--border); color: var(--muted); }
    button.danger { background: color-mix(in srgb, var(--danger) 78%, black 10%); color: white; }

    .toolbar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 8px; }
    .toolbar input[type="search"] { flex: 1; min-width: 200px; }
    .toolbar .right { margin-left: auto; display: flex; gap: 8px; }

    .grid {
      padding: 18px 16px 60px;
      display: grid; gap: 14px;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    }

    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: var(--radius);
      overflow: hidden; display: flex; flex-direction: column; min-height: 120px;
    }
    .media { aspect-ratio: 16 / 9; background: #0f141b; display: grid; place-items: center; }
    .media iframe, .media img, .media video { width: 100%; height: 100%; border: 0; object-fit: cover; }
    .content { padding: 12px; display: grid; gap: 8px; }
    .meta { display: flex; gap: 8px; align-items: center; justify-content: space-between; }
    .tag { font-size: 12px; color: var(--muted); padding: 2px 8px; border: 1px solid var(--border); border-radius: 999px; }
    .note { color: #cfd6df; white-space: pre-wrap; }
    .url a { color: var(--accent); text-decoration: none; word-break: break-word; }
    .row-actions { display: flex; gap: 8px; }
    .empty { text-align: center; color: var(--muted); padding: 40px 10px; }
    .kicker { color: var(--muted); font-size: 13px; }
    .hr { height: 1px; background: var(--border); margin: 8px 0; }

    @media (max-width: 760px) {
      .controls { grid-template-columns: 1fr 1fr; }
      .controls textarea { grid-column: 1 / -1; }
      .toolbar { flex-direction: column; align-items: stretch; }
      .toolbar .right { margin-left: 0; }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Renovation Moodboard <span class="badge">local-only</span></h1>
      <div class="kicker">Paste TikTok / Instagram / YouTube / Vimeo links — add notes — search & filter. Data is stored in your browser. Use Export/Import JSON to sync.</div>
    </div>
  </header>

  <main class="wrap" id="app-root"></main>

  <script type="text/babel">
    const {useEffect, useMemo, useRef, useState} = React;

    // ------------------------------
    // Config
    // ------------------------------
    const DEFAULT_CATEGORIES = ["Living Room", "Kitchen", "Bathroom", "Bedroom", "Backyard", "Other"];
    const LS_KEY = "moodboard-data-v1";

    // ------------------------------
    // Utilities
    // ------------------------------
    function detectProvider(url) {
      if (!url) return "link";
      const u = url.toLowerCase();
      if (u.includes("youtube.com") || u.includes("youtu.be")) return "youtube";
      if (u.includes("tiktok.com")) return "tiktok";
      if (u.includes("instagram.com")) return "instagram";
      if (u.includes("facebook.com") || u.includes("fb.watch")) return "facebook";
      if (u.includes("vimeo.com")) return "vimeo";
      if (/(\.mp4|\.webm|\.ogg)(\?|$)/i.test(u)) return "filevideo";
      if (/(\.png|\.jpg|\.jpeg|\.webp|\.gif)(\?|$)/i.test(u)) return "image";
      return "link";
    }

    function getYouTubeId(url) {
      try {
        const u = new URL(url);
        if (u.hostname === "youtu.be") return u.pathname.slice(1);
        if (u.hostname.includes("youtube.com")) {
          const v = u.searchParams.get("v"); if (v) return v;
          const parts = u.pathname.split("/").filter(Boolean);
          if (parts[0] === "shorts" && parts[1]) return parts[1];
          if (parts[0] === "embed" && parts[1]) return parts[1];
        }
      } catch {}
      return "";
    }

    function getVimeoId(url) {
      try {
        const u = new URL(url);
        if (u.hostname.includes("vimeo.com")) {
          const parts = u.pathname.split("/").filter(Boolean);
          const idx = parts[0] === "video" ? 1 : 0;
          if (parts[idx]) return parts[idx];
        }
      } catch {}
      return "";
    }

    function getTikTokId(url) {
      // Handles https://www.tiktok.com/@user/video/1234567890 and https://vm.tiktok.com/...
      const m = url.match(/\/video\/(\d+)/);
      return m ? m[1] : "";
    }

    function useLocalStorageState(key, initialValue) {
      const [state, setState] = useState(() => {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : initialValue;
        } catch {
          return initialValue;
        }
      });
      useEffect(() => {
        try { localStorage.setItem(key, JSON.stringify(state)); } catch {}
      }, [key, state]);
      return [state, setState];
    }

    function injectScriptOnce(src, id) {
      if (document.getElementById(id)) return;
      const s = document.createElement("script");
      s.src = src; s.async = true; s.id = id;
      document.body.appendChild(s);
    }

    function ensureFbRoot() {
      if (!document.getElementById("fb-root")) {
        const r = document.createElement("div");
        r.id = "fb-root"; document.body.appendChild(r);
      }
    }

    // ------------------------------
    // Media Cards
    // ------------------------------
    function YouTubeCard({ item, observe }) {
      const vid = getYouTubeId(item.url);
      const iframeRef = useRef(null);

      useEffect(() => {
        if (!vid) return;
        observe(iframeRef);
      }, [vid, observe]);

      if (!vid) return <div className="media empty">Invalid YouTube link</div>;
      const src = `https://www.youtube.com/embed/${vid}?enablejsapi=1&rel=0&mute=1&playsinline=1`;
      return (
        <div className="media">
          <iframe
            ref={iframeRef}
            src={src}
            title="YouTube"
            allow="autoplay; encrypted-media; picture-in-picture; web-share"
            allowFullScreen
          />
        </div>
      );
    }

    function VimeoCard({ item }) {
      const id = getVimeoId(item.url);
      if (!id) return <div className="media empty">Invalid Vimeo link</div>;
      const src = `https://player.vimeo.com/video/${id}?autopause=1&muted=1`;
      return (
        <div className="media">
          <iframe
            src={src}
            title="Vimeo"
            allow="autoplay; fullscreen; picture-in-picture; clipboard-write"
            allowFullScreen
          />
        </div>
      );
    }

    function TikTokCard({ item }) {
      const id = getTikTokId(item.url);
      if (!id) return <div className="media empty">Paste a TikTok video URL</div>;
      const src = `https://www.tiktok.com/embed/v2/video/${id}`;
      return (
        <div className="media">
          <iframe
            src={src}
            title="TikTok"
            allow="autoplay; encrypted-media; picture-in-picture; clipboard-write"
            allowFullScreen
          />
        </div>
      );
    }

    function InstagramCard({ item }) {
      // Use Instagram embed script to render properly
      useEffect(() => {
        injectScriptOnce("https://www.instagram.com/embed.js", "instgrm-embed");
        const t = setTimeout(() => window.instgrm?.Embeds?.process(), 50);
        return () => clearTimeout(t);
      }, [item.url]);

      return (
        <div className="media" style={{display: "block"}}>
          <blockquote className="instagram-media" data-instgrm-permalink={item.url} data-instgrm-version="14" style={{margin: 0, width: "100%"}}></blockquote>
        </div>
      );
    }

    function FacebookCard({ item }) {
      useEffect(() => {
        ensureFbRoot();
        injectScriptOnce("https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v20.0", "fb-sdk");
        const t = setTimeout(() => window.FB?.XFBML?.parse(), 100);
        return () => clearTimeout(t);
      }, [item.url]);

      return (
        <div className="media" style={{display: "block"}}>
          <div className="fb-video" data-href={item.url} data-allowfullscreen="true" data-autoplay="false" data-show-text="false"></div>
        </div>
      );
    }

    function ImageCard({ item }) {
      return (
        <div className="media">
          <img src={item.url} alt="" loading="lazy" />
        </div>
      );
    }

    function FileVideoCard({ item }) {
      return (
        <div className="media">
          <video src={item.url} controls loop muted playsInline />
        </div>
      );
    }

    function LinkCard({ item }) {
      return (
        <div className="media" style={{display:"grid", placeItems:"center", padding:16}}>
          <div className="url">
            <a href={item.url} target="_blank" rel="noreferrer">{item.url}</a>
          </div>
        </div>
      );
    }

    function MediaCard({ item, observe }) {
      switch (item.provider) {
        case "youtube": return <YouTubeCard item={item} observe={observe} />;
        case "vimeo": return <VimeoCard item={item} />;
        case "tiktok": return <TikTokCard item={item} />;
        case "instagram": return <InstagramCard item={item} />;
        case "facebook": return <FacebookCard item={item} />;
        case "image": return <ImageCard item={item} />;
        case "filevideo": return <FileVideoCard item={item} />;
        default: return <LinkCard item={item} />;
      }
    }

    // ------------------------------
    // Main App
    // ------------------------------
    function App() {
      const [items, setItems] = useLocalStorageState(LS_KEY, []);
      const [url, setUrl] = useState("");
      const [note, setNote] = useState("");
      const [category, setCategory] = useState(DEFAULT_CATEGORIES[0]);
      const [search, setSearch] = useState("");
      const [catFilter, setCatFilter] = useState("All");

      // Maintain a set of observed YouTube iframes for autoplay on scroll
      const ytIframesRef = useRef(new Set());

      const observe = React.useCallback((iframeRef) => {
        if (!iframeRef?.current) return;
        ytIframesRef.current.add(iframeRef.current);
      }, []);

      useEffect(() => {
        // IntersectionObserver to auto play/pause YouTube
        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            const el = entry.target;
            const isVisible = entry.isIntersecting && entry.intersectionRatio >= 0.6;
            try {
              const msg = JSON.stringify({ event: "command", func: isVisible ? "playVideo" : "pauseVideo", args: [] });
              el.contentWindow?.postMessage(msg, "*");
            } catch {}
          });
        }, { threshold: [0, 0.6, 1] });

        ytIframesRef.current.forEach((el) => observer.observe(el));
        return () => observer.disconnect();
      }, [items]);

      const categories = useMemo(() => {
        const base = new Set(DEFAULT_CATEGORIES);
        for (const it of items) base.add(it.category);
        return Array.from(base);
      }, [items]);

      const filtered = useMemo(() => {
        const q = search.trim().toLowerCase();
        return items.filter(it => {
          const catOk = catFilter === "All" || it.category === catFilter;
          const qOk = !q || (it.url.toLowerCase().includes(q) || (it.note || "").toLowerCase().includes(q));
          return catOk && qOk;
        });
      }, [items, search, catFilter]);

      function addItem(e) {
        e?.preventDefault?.();
        if (!url) return;
        const provider = detectProvider(url);
        const it = {
          id: Date.now() + "-" + Math.random().toString(36).slice(2, 7),
          url, note, category, provider,
          createdAt: new Date().toISOString()
        };
        setItems([it, ...items]);
        setUrl(""); setNote("");
      }

      function removeItem(id) {
        setItems(items.filter(x => x.id !== id));
      }

      function exportJSON() {
        const blob = new Blob([JSON.stringify(items, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url; a.download = "moodboard.json"; a.click();
        URL.revokeObjectURL(url);
      }

      function importJSON(file) {
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const data = JSON.parse(reader.result);
            if (Array.isArray(data)) setItems(data);
            else alert("Invalid JSON");
          } catch {
            alert("Invalid JSON");
          }
        };
        reader.readAsText(file);
      }

      return (
        <>
          <section className="wrap" style={{paddingTop: 12}}>
            <form className="controls" onSubmit={addItem}>
              <input type="url" placeholder="Paste link (YouTube, TikTok, Instagram, Vimeo, image, .mp4…)"
                     value={url} onChange={(e)=>setUrl(e.target.value)} required />
              <select value={category} onChange={(e)=>setCategory(e.target.value)}>
                {categories.map(c => <option key={c} value={c}>{c}</option>)}
              </select>
              <button type="submit">Add to board</button>
              <button type="button" className="secondary" onClick={exportJSON}>Export JSON</button>
              <label className="ghost" style={{display:"inline-block", padding:"10px 14px", borderRadius:10, border:"1px solid var(--border)", cursor:"pointer"}}>
                Import JSON
                <input type="file" accept="application/json" style={{display:"none"}}
                       onChange={(e)=>importJSON(e.target.files[0])}/>
              </label>
              <textarea placeholder="Optional note…" value={note} onChange={(e)=>setNote(e.target.value)} />
            </form>

            <div className="toolbar">
              <input type="search" placeholder="Search notes or links…" value={search} onChange={(e)=>setSearch(e.target.value)} />
              <div className="right">
                <select value={catFilter} onChange={(e)=>setCatFilter(e.target.value)}>
                  <option>All</option>
                  {categories.map(c => <option key={c}>{c}</option>)}
                </select>
                <button type="button" className="ghost" onClick={()=>{ if (confirm("Clear all items?")) setItems([]); }} >Clear all</button>
              </div>
            </div>
          </section>

          <section className="grid">
            {filtered.length === 0 && (
              <div className="empty card" style={{gridColumn:"1/-1", padding:24}}>
                No items yet. Paste a link above and hit “Add to board”.
              </div>
            )}
            {filtered.map(item => (
              <article key={item.id} className="card">
                <MediaCard item={item} observe={observe} />
                <div className="content">
                  <div className="meta">
                    <span className="tag">{item.category}</span>
                    <div className="row-actions">
                      <a className="ghost" href={item.url} target="_blank" rel="noreferrer" style={{textDecoration:"none", padding:"6px 10px", borderRadius:8, border:"1px solid var(--border)", color:"var(--muted)"}}>Open</a>
                      <button className="danger" onClick={()=>removeItem(item.id)}>Delete</button>
                    </div>
                  </div>
                  {item.note ? <div className="note">{item.note}</div> : null}
                  <div className="url"><a href={item.url} target="_blank" rel="noreferrer">{item.url}</a></div>
                </div>
              </article>
            ))}
          </section>
        </>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("app-root"));
    root.render(<App />);
  </script>

  <!-- FB SDK root for video embeds -->
  <div id="fb-root"></div>
</body>
</html>
